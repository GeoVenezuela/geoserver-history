<?xml version="1.0" encoding="ISO-8859-1" ?>

<!-- =============================================== -->
<!-- GeoServer BUILD FILE  -->
<!-- Copyright VFNY 2002 -->
<!-- This build file is licensed under the GPL v2.0 -->
<!-- If you are would like to build this project on your machine, you must: -->
<!-- (1) Modify ${dir.test}, ${dir.release} and ${dir.nightly} for your machine -->
<!-- (2) Install a servlet container, if you would like to test your changes -->
<!-- =============================================== -->


<project name="wfs" default="help" basedir=".">

<!-- =============================================== -->
<!-- PROPERTIES                                      -->
<!-- =============================================== -->

  <!-- directories -->
  <!-- you may modify this for your machine, or you may explicitly set it while running -->
  <property name="dir.test" value="/usr/local/resin-2.0.1/webapps"/>

  <!-- don't modify anything below here -->
  <property name="dir.main" value="."/>           
  <property name="dir.classes" value="${dir.main}/classes"/>
  <property name="dir.documentation" value="${dir.main}/documentation"/>
  <property name="dir.jsp" value="${dir.main}/jsp"/>
  <property name="dir.libraries" value="${dir.main}/libraries"/>
  <property name="dir.misc" value="${dir.main}/misc"/>
  <property name="dir.changelog" value="${dir.misc}/changelog"/>
  <property name="dir.data" value="${dir.misc}/testData"/>
  <property name="dir.nightly" value="${dir.main}/release/nightly"/>
  <property name="dir.release" value="${dir.main}/release/stable"/>
  <property name="dir.source" value="${dir.main}/source"/>

  <!-- jars -->
  <property name="jar.geoserver" value="${dir.libraries}/geoserver.jar"/>
  <property name="jar.log" value="${dir.libraries}/log4j.jar"/>
  <property name="jar.servlet" value="${dir.libraries}/servlet.jar"/>
  <property name="jar.xerces" value="${dir.libraries}/xerces.jar"/>
  <property name="jar.jdbcPostgres" value="${dir.libraries}/jdbcPostgres.jar"/>
  <property name="jar.castor" value="${dir.libraries}/castor.jar"/>
  <property name="jar.jts" value="${dir.libraries}/jts-1.0.0.jar"/>

  <!-- paths -->
  <path id="path.responses" path="${dir.classes}:${jar.xerces}:${jar.servlet}:${jar.log}:${jar.jaxb}"/>
  <path id="path.requests" path="${dir.classes}:${jar.jaxb}:${jar.xerces}:${jar.servlet}:${jar.log}"/>
  <path id="path.config" path="${dir.classes}:${jar.log}:${jar.castor}"/>
  <path id="path.db" path="${dir.classes}:${jar.xerces}:${jar.jaxb}:${jar.log}:${jar.jts}"/>
  <path id="path.servlets" path="${dir.classes}:${jar.jaxb}:${jar.servlet}:${jar.xerces}:${jar.log}:${jar.jdbcPostgres}"/>
  <path id="path.all" path="${jar.geoserver}:${jar.xerces}:${jar.servlet}:${jar.log}:${jar.jdbcPostgres}:${jar.castor}:${jar.jts}"/>

  <!-- names -->
  <property name="name.release" value="0.9.00"/>

<!-- =============================================== -->
<!-- HELP / INDEX OF TARGETS                         -->
<!-- =============================================== -->
  <target name="help">
    <echo message="GeoServer Build File..."/>
    <echo message="Copyright Vision For New York (www.vfny.org), 2002"/>
    <echo message="Licensed under the GPL v2.0"/>
    <echo message=""/>
    <echo message=" ADMIN TARGETS"/>
    <echo message="    startup:      makes sure that all tasks are "/>
    <echo message="    commit:       commits all changes"/>
    <echo message=""/>
    <echo message=" BASIC TARGETS"/>
    <echo message="    config:       compiles configuration package"/>
    <echo message="    db:           compiles all database packages"/>
    <echo message="    requests:     generates and compiles all request classes"/>
    <echo message="    responses:    generates and compiles all response classes"/>
    <echo message="    servlets:     compiles servlet package"/>
    <echo message=""/>
    <echo message=" INTERMEDIATE TARGETS"/>
    <echo message="    all:          compiles all application packages"/>
    <echo message="    clean:        removes, then re-compiles all application packages"/>
    <echo message="    delete:       deletes all class files"/>
    <echo message="    document:     generates all javadocs for project"/>
    <echo message="    jar:          builds jar file and puts in deploy directory"/>
    <echo message="    jarDelete:    deletes jar file"/>
    <echo message=""/>
    <echo message=" TEST/BUILD TARGETS"/>
    <echo message="    jarTest:      builds and copies geoserver.jar to the test server (specified with -Ddir.test=X, where X is full server path)"/>
    <echo message="    nightly:      puts up the nightly build"/>
    <echo message="    release:      makes a full release build"/>
    <echo message="    warTest:      builds a test version of the geoserver.war to the test server (specified with -Ddir.test=X, where X is full server path)"/>
    <echo message="    war:          builds production version of the war file"/>
    <echo message=""/>
    <echo message=" Examples..."/>
    <echo message="    ant warTest -Ddir.test=/usr/local/resin-2.0.4/webapps (copy war to specified test directory)"/>
    <echo message="    ant setup (setup initial directories)"/>
    <echo message="    ant release"/>
  </target>

<!-- =============================================== -->
<!-- ADMIN TARGETS                                   -->
<!-- =============================================== -->

<!-- INITIALIZE -->


<!-- =============================================== -->
<!-- BASIC TARGETS                                   -->
<!-- =============================================== -->

<!-- INITIALIZE -->
  <target name="init">

    <!-- time/date -->
    <tstamp><format property="date.current" pattern="MM.dd.yyyy"/></tstamp>
  </target>

<!-- RESPONSES -->
  <target name="responses" depends="init">
    <javac srcdir="${dir.source}" destdir="${dir.classes}" includes="org/vfny/geoserver/responses/**" classpathref="path.responses"/>
  </target>

<!-- REQUESTS -->
  <target name="requests" depends="init">
    <javac srcdir="${dir.source}" destdir="${dir.classes}" includes="org/vfny/geoserver/requests/**" classpathref="path.requests"/>
  </target>

<!-- CONFIGURATION -->
  <target name="config" depends="init">
    <javac srcdir="${dir.source}" destdir="${dir.classes}" includes="org/vfny/geoserver/config/**" classpathref="path.config"/>
  </target>
    
<!-- DATABASE -->
  <target name="db" depends="init">
    <javac srcdir="${dir.source}" destdir="${dir.classes}" includes="org/vfny/geoserver/db/**" classpathref="path.db"/>
  </target>

<!-- SERVLETS -->
  <target name="servlets" depends="init">
    <javac srcdir="${dir.source}" destdir="${dir.classes}" includes="org/vfny/geoserver/servlets/**" classpathref="path.servlets" deprecation="on"/>
  </target>


<!-- =============================================== -->
<!-- INTERMEDIATE TARGETS                            -->
<!-- =============================================== -->

<!-- JAR -->
<!-- builds geoserver jar -->
  <target name="jar" depends="init">
    <jar jarfile="${dir.libraries}/geoserver.jar">
      <fileset dir="${dir.classes}">
        <exclude name="**/servlets/*" />
      </fileset>
    </jar>
  </target>

<!-- DELETE JAR -->
<!-- deletes geoserver jar; use with caution due to dependencies -->
  <target name="deleteJar" depends="init">
    <delete file="${dir.libraries}/geoserver.jar" failonerror="true"/>
  </target>

<!-- DOCUMENTATION -->
<!-- generates all project documentation -->
  <target name="document" depends="init">
    <javadoc sourcepath="${dir.main}/source"
						 destdir="${dir.documentation}/api"
						 private="true"
						 windowtitle="GeoServer Documentation"
						 classpath="${jar.jaxb}:${jar.servlet}:${jar.xerces}:${jar.log}:${jar.jdbcPostgres}:${jar.castor}:${jar.jts}"
						 stylesheetfile="${dir.misc}/documents/stylesheet.css">
      <package name="org.vfny.geoserver.*"/>
      <doctitle><![CDATA[<h1>GeoServer Documentation</h1>]]></doctitle>
      <bottom><![CDATA[<i>Copyright &#169; 2002 Vision for New York. All Rights Reserved.</i>]]></bottom>

      <!-- link documents -->
      <link offline="true" href="http://java.sun.com/xml/jaxb" packagelistLoc="${dir.misc}/packageLists/jax-b"/>
      <link offline="true" href="http://java.sun.com/products/jdk/1.2/docs/api/" packagelistLoc="${dir.misc}/packageLists/jdk"/>
      <link offline="true" href="http://java.sun.com/j2ee/sdk_1.2.1/techdocs/api/" packagelistLoc="${dir.misc}/packageLists/servlet"/>
      <link offline="true" href="http://java.sun.com/xml/sax" packagelistLoc="${dir.misc}/packageLists/xerces"/>
      <link offline="true" href="http://jakarta.apache.org/log4j/docs/api/" packagelistLoc="${dir.misc}/packageLists/log4j"/>

    </javadoc>
  </target>

<!-- ALL -->
<!-- compiles all packages -->
  <target name="all" depends="config, db, requests, responses, servlets"/>

<!-- DELETE -->
<!-- deletes all packages -->
  <target name="delete" depends="init">
    <delete includeEmptyDirs="false" >
      <fileset dir="${dir.classes}" />
    </delete>
  </target>

<!-- CLEAN -->
<!-- cleans, then compiles all packages -->
  <target name="cleanBuild" depends="delete">
    <javac srcdir="${dir.source}" destdir="${dir.classes}" includes="**" classpathref="path.all"/>
  </target>

  <target name="clean" depends="cleanBuild, deleteJar, jar"/>


<!-- =============================================== -->
<!-- TEST TARGETS -->
<!-- =============================================== -->

<!-- TEST JAR -->
<!-- deploys application to test server -->
  <target name="jarTest" depends="init, all, jar">
    <delete file="${dir.test}/geoserver/WEB-INF/lib/geoserver.jar" failonerror="false"/>
    <copy file="${dir.libraries}/geoserver.jar" tofile="${dir.test}/geoserver/WEB-INF/lib/geoserver.jar"/>
  </target>

<!-- TEST WAR -->
<!-- compiles application to the 'deploy' directory -->
  <target name="warTest" depends="init, all, jar">

    <!-- preparation -->
    <delete file="${dir.main}/geoserver.war" failonerror="false"/>
    <delete dir="${dir.main}/data" failonerror="false"/>

    <mkdir dir="${dir.main}/data"/>
    <copy todir="${dir.main}/data" >
      <fileset dir="${dir.misc}/documents">
        <include name="license.txt"/>
        <include name="geoserver.log"/>
        <include name="configuration.xml"/>
      </fileset>
    </copy>

    <mkdir dir="${dir.main}/data/capabilities"/>
    <copy todir="${dir.main}/data/capabilities">
      <fileset dir="${dir.misc}/documents">
        <include name="filter.xml"/>
        <include name="operations.xml"/>
        <include name="serviceMetadata.xml"/>
        <include name="additionalCapabilities.xml"/>
        <include name="operationsSignatures.xml"/>
        <include name="vfnyWfsWsdl.xml"/>
        <include name="OGC_Capabilities.xsd"/>
        <include name="feature.xsd"/>
        <include name="geometry.xsd"/>
      </fileset>
    </copy>

    <mkdir dir="${dir.main}/data/featureTypes"/>
    <copy todir="${dir.main}/data">
      <fileset dir="${dir.data}"/>
    </copy>

    <!-- war file -->
    <war warfile="${dir.main}/geoserver.war" webxml="${dir.misc}/documents/web.xml" update="true">

      <!-- classes -->
      <classes dir="${dir.classes}">
        <include name="**/servlets/**" />
        <exclude name="**/servlets/utilities/**" />
      </classes>
      <classes dir="${dir.jsp}"/>
      <lib dir="${dir.libraries}"/>

      <!-- directories -->
      <fileset dir="${dir.main}">
        <include name="data/**"/>
        <include name="documentation/**"/>
      </fileset>
    </war>

    <!-- copy to test server -->
    <delete includeEmptyDirs="true" failonerror="false">
      <fileset dir="${dir.test}/geoserver"/>
    </delete>
    <delete file="${dir.test}/geoserver.war"  failonerror="false"/>
    <copy todir="${dir.test}/" flatten="yes">
      <fileset dir="${dir.main}">
        <include name="geoserver.war"/>
      </fileset>
    </copy>

    <!-- clean-up -->
    <delete file="${dir.main}/geoserver.war" failonerror="true"/>
    <delete dir="${dir.main}/data" failonerror="true"/>
  </target>


<!-- =============================================== -->
<!-- BUILD TARGETS -->
<!-- =============================================== -->

<!-- BUILD PRODUCTION WAR -->
<!-- creates a production version of the WAR at application root -->
<!-- identical to test war, except web.xml is slightly different -->
  <target name="war" depends="init, jar">

    <!-- preparation -->
    <delete file="${dir.main}/geoserver.war" failonerror="false"/>
    <delete dir="${dir.main}/data" failonerror="false"/>

    <mkdir dir="${dir.main}/data"/>
    <copy todir="${dir.main}/data" >
      <fileset dir="${dir.misc}/documents">
        <include name="license.txt"/>
        <include name="geoserver.log"/>
        <include name="configuration.xml"/>
      </fileset>
    </copy>

    <mkdir dir="${dir.main}/data/capabilities"/>
    <copy todir="${dir.main}/data/capabilities">
      <fileset dir="${dir.misc}/documents">
        <include name="filter.xml"/>
        <include name="operations.xml"/>
        <include name="serviceMetadata.xml"/>
        <include name="additionalCapabilities.xml"/>
        <include name="operationsSignatures.xml"/>
        <include name="vfnyWfsWsdl.xml"/>
        <include name="OGC_Capabilities.xsd"/>
        <include name="feature.xsd"/>
        <include name="geometry.xsd"/>
      </fileset>
    </copy>

    <mkdir dir="${dir.main}/data/featureTypes"/>
    <copy todir="${dir.main}/data">
      <fileset dir="${dir.data}"/>
    </copy>

    <!-- war file -->
    <war warfile="${dir.main}/geoserver.war" webxml="${dir.misc}/documents/web.xml" update="true">

      <!-- classes -->
      <classes dir="${dir.classes}">
        <include name="**/servlets/**" />
        <exclude name="**/servlets/utilities/**" />
      </classes>
      <classes dir="${dir.jsp}"/>
      <lib dir="${dir.libraries}"/>

      <!-- directories -->
      <fileset dir="${dir.main}">
        <include name="data/**"/>
        <include name="documentation/**"/>
      </fileset>
    </war>

    <!-- clean-up -->
    <delete dir="${dir.main}/data" failonerror="true"/>
  </target>


<!-- BUILD RELEASE -->
<!-- builds a release version of the application -->
  <target name="release" depends="init, war">
    <delete file="${dir.main}/geoserver-${name.release}.tar.gz" failonerror="false"/>
    <delete file="${dir.main}/geoserver-${name.release}.tar" failonerror="false"/>

    <copy file="${dir.misc}/documents/license.txt" todir="${dir.main}"/>
    <tar longfile="gnu"
         basedir="${dir.main}"
				 tarfile="geoserver-${name.release}.tar"/>

    <delete file="${dir.main}/geoserver-${name.release}.tar.gz" failonerror="false"/>
    <gzip src="geoserver-${name.release}.tar" zipfile="geoserver-${name.release}.tar.gz"/>
    <copy file="${dir.main}/geoserver-${name.release}.tar.gz" todir="${dir.release}"/>

    <delete file="${dir.main}/geoserver-${name.release}.tar.gz" failonerror="true"/>
    <delete file="${dir.main}/geoserver-${name.release}.tar" failonerror="true"/>
    <delete file="${dir.main}/geoserver.war" failonerror="true"/>
    <delete file="${dir.main}/license.txt" failonerror="true"/>
  </target>


<!-- CREATE NIGHTLY BUILD -->
<!-- archives the current version of the project -->
  <target name="nightly" depends="init, war">
    <delete file="${dir.main}/changelog-${date.current}.txt" failonerror="false"/>
    <copy file="${dir.changelog}/changelog-${date.current}.txt" todir="${dir.main}"/>

    <delete file="${dir.main}/geoserver-${date.current}.tar" failonerror="false"/>
    <delete file="${dir.nightly}/geoserver-${date.current}.tar.gz" failonerror="false"/>
    <tar tarfile="${dir.main}/geoserver-${date.current}.tar" basedir="${dir.main}" longfile="gnu"/>
    <gzip src="${dir.main}/geoserver-${date.current}.tar" zipfile="${dir.nightly}/geoserver-${date.current}.tar.gz"/>

    <delete file="${dir.main}/geoserver.war"  failonerror="false"/>
    <delete file="${dir.main}/geoserver-${date.current}.tar" failonerror="false"/>
    <delete file="${dir.main}/changelog-${date.current}.txt" failonerror="false"/>
  </target>

</project>
